<!doctype html>
<html>
  <head>
    <title></title>
    <link rel="stylesheet" href="./node_modules/jasmine-core/lib/jasmine-core/jasmine.css"/>
    <link rel="stylesheet" href="./stylesheet.css"/>
    <script src="./node_modules/requirejs/require.js"></script>
  </head>
  <body>
    <script>
      requirejs.config({
        baseUrl: "/",
        paths: {
          "ace": "./node_modules/ace-builds/src",
          "json": "./node_modules/requirejs-json/json",
          "text": "./node_modules/requirejs-text/text",
          "jasmine": "./node_modules/jasmine-core/lib/jasmine-core"
        },
        shim: {
          "boot": ["jasmine/jasmine", "jasmine/jasmine-html"],
          "jasmine/jasmine-html": ["jasmine/jasmine"]
        }
      });
      requirejs(["boot"], () => {
        require([
          "./generate-component-link-tree/index.js",
          "./node_modules/example-component/index.js",
          "./sidebar-component/index.js",
          "json!./component/package.json",
          "boot"
        ], (generateComponentLinkTree, ExampleComponent, SidebarComponent, package, Boot) => {
          generateComponentLinkTree({
            componentId: package.name,
            dependencyIds: package.component.dependencies
          })
          .then((navigation) => {
            let navigate = (link) => {
              Boot();
              require([
                "node_modules/" + link.title + "/index",
                "json!node_modules/" + link.title + "/package.json",
                "node_modules/" + link.title + "/spec.js?" + new Date().getTime() // TODO: This downloads every time, need to cache specs somehow
              ], (Component, package) => {
                document.body.innerHTML = "";
                document.body.appendChild(SidebarComponent({
                  header: {
                    heading: "Component Workshop"
                  },
                  navigation,
                  onNavigate: (link) => {
                    history.pushState(link, link.title, link.url);
                    navigate(link);
                  }
                }));
                document.body.appendChild(ExampleComponent({
                  name: package.name,
                  version: package.version,
                  description: package.description,
                  component: Component,
                  data: package.component.data,
                }));
                jasmine.getEnv().load();
              });
            };
            window.onpopstate = ({state}) => {
              navigate(state);
            }
            navigate(navigation);
          });
        });
      });
    </script>
    <script>
      document.write(
        '<script src="http://' +
        (location.host || 'localhost').split(':')[0] +
        ':35729/livereload.js?snipver=1"></' +
        'script>'
      );
    </script>
  </body>
</html>
